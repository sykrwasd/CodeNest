<?php 

include('../config/database.php');

//print_r($_SESSION);

$adminID = $_SESSION['userID'];

$sql = "SELECT s.* FROM staff s, payroll p WHERE s.staffid = p.staffid";
$result = mysqli_query($conn, $sql);

if (mysqli_num_rows($result) > 0) {
  // output data of each row
  while($row = mysqli_fetch_assoc($result)) {
    $staffName = $row['staffFullName'];
  }
} else {
  echo "0 results";
}


?>

<!-- Add Font Awesome CDN in your page's <head> if not already included -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
      integrity="sha512-pO3Cz4PiODsjixgH0M3mqJe6Vrx/ovOW3BJ6Fx3Xy7eRO1THXt/1zLQ7u+XDfM80Rk8+3nj2yl1p8S2bW2E1Lg==" 
      crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="container bg-white p-4 rounded shadow-sm">
    <h3 class="mb-4 text-center">All Staff Payroll</h3>

    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
            <thead class="table-dark text-center">
                <tr>
                    <th><i class="fa-solid fa-id-badge"></i> Staff ID</th>
                    <th><i class="fa-solid fa-user"></i>Name</th>
                    <th><i class="fa-solid fa-envelope-open-text"></i> NetSalary</th>
                    <th><i class="fa-solid fa-gear"></i> Bonus</th>
                    <th><i class="fa-solid fa-gear"></i> Deduction</th>
                    <th><i class="fa-solid fa-gear"></i> Action</th>
                    
                </tr>
            </thead>
            <tbody id="requestTable">
                <?php 
                $viewQuery = $conn->prepare('
    SELECT p.*, s.staffFullName 
    FROM payroll p 
    INNER JOIN staff s ON p.staffID = s.staffID');
    
                $viewQuery->execute();
                $result = $viewQuery->get_result();

                while ($row = $result->fetch_assoc()) {
                ?>
                <tr class="text-center">
                  
                 <form action="../functions/update.php" method="post">
                       <input type="hidden" name="type" value="payroll">
                         <input type="hidden" name="payrollID" value="<?php echo $row['payrollID']; ?>">
                    <td><a href="admin_sidebar.php?page=view_staff"><?php echo $row['staffID']; ?></a></td>
                    <td><?php echo $row['staffFullName']; ?></td>
                    <td>RM<?php echo $row['netsalary']; ?></td>
                    
                    <td><input type="text" value="<?php echo $row['bonus']; ?>" name="bonus"></td>
                  <td><input type="text" value="<?php echo $row['deduction']; ?>" name="deduction"></td>
                    <td><button type="submit" class="btn btn-primary">Update</button></td>
                </form>
                </tr>
                <?php } ?>
            </tbody>
        </table>
    </div>
</div>



 <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Staff Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBody">
          <form method="POST" action="" enctype="multipart/form-data">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="ev" class="form-label fw-semibold">Bonus</label>
                    
                    <input type="text" class="form-control" name="bonus" id="ev" required>
                </div>
               <div class="col-md-4">
                    <label for="id" class="form-label fw-semibold">Deduction</label>
                    <input type="text" class="form-control" name="deduction" id="e" required>
                </div>
            
            <div class="text-end">
                <button type="submit" class="btn btn-primary">Submit Evaluation</button>
            </div>
        </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

